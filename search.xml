<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title></title>
    <url>%2F2018%2F07%2F16%2FSpring-chapter2%2F</url>
    <content type="text"><![CDATA[我的第二篇博客1 能力适配平台 能力适配的主要功能是进行服务的调用，BU通过能力适配平台调用AU,功能和配置都类似于ESB,(鉴权/协议转换/路由/访问控制/交易记录)给运维平台同步交易信息，配置模式为标准的TOMCAT容器和应用以及后端数据库的配置。 1、容器配置：server.xml 端口配置以及应用路径指向，context.xml对数据库的连接定义 2、应用配置：配置app启动加载参数，同类一起修改 3、数据库的配置 &lt;!--more--&gt; 1.1 CAF1.1.1 server.xml文件文件存放路径：/app/esb/tomcat/CAF/apache-tomcat-7.0.42/conf //shutdown外端口Connector port=”5001” protocol=”HTTP/1.1” //对外连接的端口号 connectionTimeout=”120000” //超时时间 redirectPort=”8443”Host name=”localhost” appBase=”/app/esb/webapps/cafapp” unpackWARs=”true” autoDeploy=”true //app文件路径1.1.2 context.xml 文件文件存放路径：/app/esb/tomcat/CAF/apache-tomcat-7.0.42/conf（1）配置库设置 （2）交易库配置 （3）日志库配置 （4）ftp数据库配置 &lt;Resource name=”jdbc/EsbFtpDS” auth=”Container” type=”javax.sql.DataSource” driverClassName=”com.mysql.jdbc.Driver” url=”jdbc:mysql://10.161.4.69:3309/ESBFTPDB?useUnicode=true&amp;characterEncoding=utf8&amp;amp;zeroDateTimeBehavior=convertToNull” username=”dbesbftp” password=”ESBecs00” maxActive=”10” validationQuery=”select 1 from dual” testWhileIdle=”true” testOnBorrow=”false” timeBetweenEvictionRunsMillis=”5000” numTestsPerEvictionRun=”30” maxIdle=”1” connectionProperties=”SetBigStringTryClob=true1.1.3 spring_applicationContext.xml 文件文件存放路径：/app/esb/webapps/cafapp/CAF/WEB-INF/classesjee:jndi-lookup id=”dataSource” jndi-name=”${EsbCfgDs}” /&gt; &lt;jee:jndi-lookup id=”logDataSource00” jndi-name=”${EsbLogDS_00}” /&gt; &lt;jee:jndi-lookup id=”cLogDataSource” jndi-name=”${EsbCLogDS}” /&gt; &lt;jee:jndi-lookup id=”esbFtpDataSource” jndi-name=”${EsbFtpDs} //数据源配置11.1.4 tom.properties文件文件存放路径：/app/esb/webapps/cafapp/CAF/WEB-INF/classesEsbCfgDs=java\:comp/env/jdbc/EsbCfgDSEsbFtpDs=java\:comp/env/jdbc/EsbFtpDSEsbLogDS_00=java\:comp/env/jdbc/EsbLogDS_00EsbCLogDS=java\:comp/env/jdbc/EsbCLogDS //数据源配置2 两个必须相匹配1.2 CAS1.2.1 server.xml文件文件存放路径：/app/esb/tomcat/CAS/apache-tomcat-7.0.42/conf //shutdown外端口Host name=”localhost” appBase=”/app/esb/webapps/casapp” unpackWARs=”true” autoDeploy=”false //app路径1.2.2 context.xml文件文件存放路径：/app/esb/tomcat/CAS/apache-tomcat-7.0.42/conf(1)CAS配置库配置 &lt;Resource name=”jdbc/EsbCfgDS” auth=”Container” type=”javax.sql.DataSource” driverClassName=”com.mysql.jdbc.Driver” url=”jdbc:mysql://10.161.4.69:3309/ESBCFGDB?useUnicode=true&amp;retriesAllDown=3&amp;secondsBeforeRetryMaster=60&amp;failOverReadOnly=false&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull” username=”dbesbcfg” password=”ESBecs00” maxActive=”10” validationQuery=”select 1 from dual” testWhileIdle=”true” testOnBorrow=”false” timeBetweenEvictionRunsMillis=”5000” numTestsPerEvictionRun=”30” maxIdle=”3” connectionProperties=”SetBigStringTryClob=tru1.3 OSN1.3.1 server.xml文件文件存放路径：/app/esb/tomcat/OSN/apache-tomcat-7.0.42/conf Server port=”8103” shutdown=”SHUTDOWN //关闭外端口Connector executor=”ThreadPool_CA” port=”8101” enableLookups=”false” bufferSize=”4096” protocol=”HTTP/1.1” connectionTimeout=”120000” maxPostSize=”0” redirectPort=”8443” /&gt; //CA检测OSN端口 //OSN对外公布的端口 &lt;Connector executor=”ThreadPool_SC_asyn” port=”8102” enableLookups=”false” bufferSize=”4096” protocol=”HTTP/1.1” connectionTimeout=”120000” maxPostSize=”0” redirectPort=”8443” / //SC返回OSN的异步端口&gt; &lt;Connector executor=”ThreadPool_Https_OParty” keystoreFile=”/app/esb/tomcat/OSN/esb_server.keystore” port=”8006” SSLEnabled=”true” maxThreads=”150” keystorePass=”storepass” scheme=”https” clientAuth=”false” sslProtocol=”TLS” enableLookups=”false” bufferSize=”4096” protocol=”HTTP/1.1” connectionTimeout=”120000” maxPostSize=”0” redirectPort=”8443” //OSN传输key的端口Host name=”localhost” appBase=”/app/esb/webapps/osnapp” unpackWARs=”true” autoDeploy=”false”&gt; //app所在路径设置1.3.2 context.xml文件文件存放路径：/app/esb/tomcat/OSN/apache-tomcat-7.0.42/conf（1）Resource name=”jdbc/EsbCfgDS” auth=”Container” type=”javax.sql.DataSource” driverClassName=”com.mysql.jdbc.Driver” url=”jdbc:mysql://10.161.4.69:3309/ESBCFGDB?useUnicode=true&amp;retriesAllDown=3&amp;secondsBeforeRetryMaster=60&amp;failOverReadOnly=false&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull” username=”dbesbcfg” password=”ESBecs00” maxActive=”10” validationQuery=”select 1 from dual” testWhileIdle=”true” testOnBorrow=”false” timeBetweenEvictionRunsMillis=”5000” numTestsPerEvictionRun=”30” maxIdle=”3” connectionProperties=”SetBigStringTryClob=true //OSN配置库设置1.3.3 SYS_PARA.PROPERTIES文件 ##如果配置此项则以容器host配置为准NODE_IP=10.124.150.230PORT=2189IS_DEVELOPE_MODEL=false #环境标识 #ENVIRONMENT_MARK=product 1.4 HSN1.4.1server.xml文件文件存放路径：/app/esb/tomcat/HSN/apache-tomcat-7.0.42/confServer port=”8304” shutdown=SHUTDOWN //HSN关闭外端口Connector executor=”ThreadPool_CA” port=”8301” enableLookups=”false” bufferSize=”4096” protocol=”HTTP/1.1” connectionTimeout=”120000” maxPostSize=”0” redirectPort=”8443” //CA检测HSN外端口Connector executor=”ThreadPool_sync” port=”8302” enableLookups=”false” bufferSize=”4096” protocol=”HTTP/1.1” connectionTimeout=”120000” maxPostSize=”0” redirectPort=”8443” // SC同步请求HSN的同步端口Connector executor=”ThreadPool_asyn” port=”8303” enableLookups=”false” bufferSize=”4096” protocol=”HTTP/1.1” connectionTimeout=”120000” maxPostSize=”0” redirectPort=”8443” // SC同步请求HSN的异步端口Host name=”localhost” appBase=”/app/esb/webapps/hsnapp” unpackWARs=”true” autoDeploy=”false” //app所在路径1.4.2SYS_PARA.PROPERTIES文件 ##如果配置此项则以容器host配置为准NODE_IP=10.124.150.230PORT=2189IS_DEVELOPE_MODEL=false #环境标识 #ENVIRONMENT_MARK=product1.5 SC1.5.1 server.xml文件存放路径：/app/esb/tomcat/SC/apache-tomcat-7.0.42/confConnector executor=”ThreadPool_ftp” port=”8201” maxPostSize=”0” enableLookups=”false” bufferSize=”4096” protocol=”HTTP/1.1” connectionTimeout=”120000” redirectPort=”8443” &lt;Connector executor=”ThreadPool_CA” port=”8201” enableLookups=”false” bufferSize=”4096” protocol=”HTTP/1.1” connectionTimeout=”120000” maxPostSize=”0” redirectPort=”8443” //CA检测SC的端口Connector executor=”ThreadPool_OSN_sync” enableLookups=”false” bufferSize=”4096” port=”8202” protocol=”HTTP/1.1” connectionTimeout=”120000” maxPostSize=”0” redirectPort=”8443” //OSN请求SC的同步端口Connector executor=”ThreadPool_OSN_asyn” enableLookups=”false” bufferSize=”4096” port=”8203” protocol=”HTTP/1.1” connectionTimeout=”120000” maxPostSize=”0” redirectPort=”8443” //OSN请求SC的异步端口Connector executor=”ThreadPool_HSN_asyn” enableLookups=”false” bufferSize=”4096” port=”8204” protocol=”HTTP/1.1” connectionTimeout=”120000” maxPostSize=”0” redirectPort=”8443” //HSN响应SC的异步端口Host name=”localhost” appBase=”/app/esb/webapps/scapp” unpackWARs=”true” autoDeploy=”false” //app所在路径 //修改tomcat线程池名称1.4.2CATALINA.SH文件/app/esb/tomcat/HSN/apache-tomcat-7.0.42/bin把红字 注释掉 Ensure that any user defined CLASSPATH variables are not used on startup,but allow them to be specified in setenv.sh, in rare case when it is needed.#CLASSPATH=/lc_esb/ESBTEST/profile/HSN/HSN1:$JAVA_HOME/lib/tools.jarCLASSPATH=/app/esb/esbconf/HSN1:$JAVA_HOME/lib/tools.jarJAVA_OPTS=”$JAVA_OPTS -Daddress.server.domain=jmenv.tbsite.net -Daddress.server.port=8080 -Dconfigserver.client.port=9600 -Dspas.identity=$CATALINA_HOME/conf/hsf-key.txt” if [ -r “$CATALINA_BASE/bin/setenv.sh” ]; then . “$CATALINA_BASE/bin/setenv.sh”elif [ -r “$CATALINA_HOME/bin/setenv.sh” ]; then . “$CATALINA_HOME/bin/setenv.sh” 5.5.2 context.xml文件文件所在路径：/app/esb/tomcat/SC/apache-tomcat-7.0.42/confResource name=”jdbc/EsbCfgDS” auth=”Container” type=”javax.sql.DataSource” driverClassName=”com.mysql.jdbc.Driver” url=”jdbc:mysql://10.161.4.69:3309/ESBCFGDB?useUnicode=true&amp;retriesAllDown=3&amp;secondsBeforeRetryMaster=60&amp;failOverReadOnly=false&amp;characterEncoding=utf8&amp;zeroDateTimeBehavior=convertToNull” username=”dbesbcfg” password=”ESBecs00” maxActive=”10” validationQuery=”select 1 from dual” testWhileIdle=”true” testOnBorrow=”false” timeBetweenEvictionRunsMillis=”5000” numTestsPerEvictionRun=”30” maxIdle=”3” connectionProperties=”SetBigStringTryClob=true //SC配置文件设置 1.5.3 SYS_PARA.PROPERTIES文件 ##如果配置此项则以容器host配置为准NODE_IP=10.124.150.230PORT=2189IS_DEVELOPE_MODEL=false #环境标识 #ENVIRONMENT_MARK=product 1.6 数据库的配置1.6.1数据库配置只需修改sys_para表和log_db表，其他对数据库的更改操作需咨询开发后在做编号 字段名称 字段类型 备注1 SYS_PARA_NAME varchar(64)2 SYS_PARA_VALUE varchar(128)3 IS_CAN_REFRESH tinyint(4)4 DESCRIBES varchar(1024) 修改字段SYS_PARA_NAME SYS_PARA_VALUE IS_CAN_REFRESH DESCRIBESCAS_MACHINE_IPS 132.42.33.183 1 CAS所在机器的可能IP集CAS_NODE_IP 132.42.33.183 1 CAS所在的机器IPCAS_NODE_PORT 8001 1 CAS所监听的端口FTP_NODE_IP 132.42.33.183 0 处理FTP的SC的IPFTP_NODE_PORT 9201 0 处理FTP的SC的端口FTP_UPLOAD_DOWN_PORT_HTTP 9201,9202 1 能过HTTP协议上传下载文件端口OUT_ADDR_IP 132.42.33.183 1 ESB对外提供的访问IP（四层交换机虚拟IP）OUT_ADDR_PORT 9102 1 ESB对外提供的访问端口（四层交换机虚拟端口）CFGDB_LINKSTR jdbc:mysql://132.42.33.175:3306/ESBCFGDB 0 配置库jdbc连接串CLOGDB_LINKSTR jdbc:mysql://132.42.33.175:3306/ESBCLOGDB 0 clog库连接串FTPDB_LINKSTR jdbc:mysql://132.42.33.175:3306/ESBFTPDB 0 FTP库连接串1.6.2sys_para表的修改delete from esbcfgdb.sys_para where sys_para_name = ‘UNIBSS_FULLSVC_WS_VALID_IGNORE’;delete from esbcfgdb.sys_para where sys_para_name =’UNIBSS_BBSS_WS_VALID_IGNORE’;alter table esbcfgdb.SC_LOGDB change column MAX_IDLE_COUNT to LONG_CONN_NUM int;commit;alter table esbclogdb.sc_mon_log add ASYN_RUNNING_UPD_QUEUE_LEN INTEGER not NULL;alter table esbclogdb.sc_mon_log add CONSTRAINT CSC_MONASYN_RUNNIUEUE_LENN_LOG CHECK (“ASYN_RUNNING_UPD_QUEUE_LEN” &gt;= 0);insert into esbcfgdb.sys_para (sys_para_name,sys_para_value,describes,is_can_refresh)values(‘FTP_SYNCFILE_AUTO_MOVE_IN_DAYS’,2,’N天内同步上传但是未下载的文件自动转移’,1);DELETE from esbcfgdb.sys_para where sys_para_name in (‘HSN_CFGDS_MAXACTIVE’, ‘HSN_CFGDS_MAXIDLE’, ‘CAS_CFGDS_MAXACTIVE’, ‘CAS_CFGDS_MAXIDLE’, ‘CAS_FTPDS_MAXACTIVE’, ‘CAS_FTPDS_MAXIDLE’, ‘CAS_CLOGDS_MAXACTIVE’, ‘CAS_CLOGDS_MAXIDLE’, ‘SC_CFGDS_MAXACTIVE’, ‘SC_CFGDS_MAXIDLE’, ‘SC_FTPDS_MAXACTIVE’, ‘SC_FTPDS_MAXIDLE’, ‘SC_CLOGDS_MAXACTIVE’, ‘SC_CLOGDS_MAXIDLE’, ‘OSN_CFGDS_MAXACTIVE’, ‘OSN_CFGDS_MAXIDLE’, ‘OSN_CLOGDS_MAXACTIVE’, ‘OSN_CLOGDS_MAXIDLE’, ‘DEFAULT_LOGDS_MAXACTIVE’, ‘DEFAULT_LOGDS_MAXIDLE’, ‘DEFAULT_DS_REMOVEABANDONEDTIMEOUT’, ‘DEFAULT_DS_SETNUMTESTSPEREVICTIONRUN’, ‘DEFAULT_DS_SETMINEVICTABLEIDLETIMEMILLIS’, ‘DEFAULT_DS_TIMEBETWEENEVICTIONRUNSMILLIS’, ‘DS_VALIDATIONQUERY’, ‘DEFAULT_DS_REMOVEABANDONED’);insert into esbcfgdb.sys_para (SYS_PARA_NAME, SYS_PARA_VALUE, DESCRIBES, IS_CAN_REFRESH)values (‘HSN_CFGDS_MAXACTIVE’, ‘30’, ‘HSN_CFG数据源最大连接数’, 0);insert into esbcfgdb.sys_para (SYS_PARA_NAME, SYS_PARA_VALUE, DESCRIBES, IS_CAN_REFRESH)values (‘HSN_CFGDS_LONG_CONN_NUM’, ‘1’, ‘HSN_CFG数据源长连接数’, 0);insert into esbcfgdb.sys_para (SYS_PARA_NAME, SYS_PARA_VALUE, DESCRIBES, IS_CAN_REFRESH)values (‘CAS_CFGDS_MAXACTIVE’, ‘30’, ‘CAS_CFG数据源最大连接数’, 0);insert into esbcfgdb.sys_para (SYS_PARA_NAME, SYS_PARA_VALUE, DESCRIBES, IS_CAN_REFRESH)values (‘CAS_CFGDS_LONG_CONN_NUM’, ‘5’, ‘CAS_CFG数据源长连接数’, 0);insert into esbcfgdb.sys_para (SYS_PARA_NAME, SYS_PARA_VALUE, DESCRIBES, IS_CAN_REFRESH)values (‘CAS_FTPDS_MAXACTIVE’, ‘30’, ‘CAS_FTP数据源最大连接数’, 0);insert into esbcfgdb.sys_para (SYS_PARA_NAME, SYS_PARA_VALUE, DESCRIBES, IS_CAN_REFRESH)values (‘CAS_FTPDS_LONG_CONN_NUM’, ‘5’, ‘CAS_FTP数据源长连接数’, 0);insert into esbcfgdb.sys_para (SYS_PARA_NAME, SYS_PARA_VALUE, DESCRIBES, IS_CAN_REFRESH)values (‘CAS_CLOGDS_MAXACTIVE’, ‘10’, ‘CAS_CLOG数据源最大连接数’, 0);insert into esbcfgdb.sys_para (SYS_PARA_NAME, SYS_PARA_VALUE, DESCRIBES, IS_CAN_REFRESH)values (‘CAS_CLOGDS_LONG_CONN_NUM’, ‘5’, ‘CAS_CLOG数据源长连接数’, 0);insert into esbcfgdb.sys_para (SYS_PARA_NAME, SYS_PARA_VALUE, DESCRIBES, IS_CAN_REFRESH)values (‘SC_CFGDS_MAXACTIVE’, ‘50’, ‘CAS_CFG数据源最大连接数’, 0);insert into esbcfgdb.sys_para (SYS_PARA_NAME, SYS_PARA_VALUE, DESCRIBES, IS_CAN_REFRESH)values (‘SC_CFGDS_LONG_CONN_NUM’, ‘1’, ‘CAS_CFG数据源长连接数’, 0);insert into esbcfgdb.sys_para (SYS_PARA_NAME, SYS_PARA_VALUE, DESCRIBES, IS_CAN_REFRESH)values (‘SC_FTPDS_MAXACTIVE’, ‘30’, ‘CAS_FTP数据源最大连接数’, 0);insert into esbcfgdb.sys_para (SYS_PARA_NAME, SYS_PARA_VALUE, DESCRIBES, IS_CAN_REFRESH)values (‘SC_FTPDS_LONG_CONN_NUM’, ‘5’, ‘CAS_FTP数据源长连接数’, 0);insert into esbcfgdb.sys_para (SYS_PARA_NAME, SYS_PARA_VALUE, DESCRIBES, IS_CAN_REFRESH)values (‘SC_CLOGDS_MAXACTIVE’, ‘10’, ‘CAS_CLOG数据源最大连接数’, 0);insert into esbcfgdb.sys_para (SYS_PARA_NAME, SYS_PARA_VALUE, DESCRIBES, IS_CAN_REFRESH)values (‘SC_CLOGDS_LONG_CONN_NUM’, ‘1’, ‘CAS_CLOG数据源长连接数’, 0);insert into esbcfgdb.sys_para (SYS_PARA_NAME, SYS_PARA_VALUE, DESCRIBES, IS_CAN_REFRESH)values (‘OSN_CFGDS_MAXACTIVE’, ‘30’, ‘CAS_CFG数据源最大连接数’, 0);insert into esbcfgdb.sys_para (SYS_PARA_NAME, SYS_PARA_VALUE, DESCRIBES, IS_CAN_REFRESH)values (‘OSN_CFGDS_LONG_CONN_NUM’, ‘1’, ‘CAS_CFG数据源长连接数’, 0);insert into esbcfgdb.sys_para (SYS_PARA_NAME, SYS_PARA_VALUE, DESCRIBES, IS_CAN_REFRESH)values (‘OSN_CLOGDS_MAXACTIVE’, ‘10’, ‘CAS_CLOG数据源最大连接数’, 0);insert into esbcfgdb.sys_para (SYS_PARA_NAME, SYS_PARA_VALUE, DESCRIBES, IS_CAN_REFRESH)values (‘OSN_CLOGDS_LONG_CONN_NUM’, ‘1’, ‘CAS_CLOG数据源长连接数’, 0);insert into esbcfgdb.sys_para (SYS_PARA_NAME, SYS_PARA_VALUE, DESCRIBES, IS_CAN_REFRESH)values (‘DEFAULT_LOGDS_MAXACTIVE’, ‘20’, ‘默认LOG数据源最大连接数’, 0);insert into esbcfgdb.sys_para (SYS_PARA_NAME, SYS_PARA_VALUE, DESCRIBES, IS_CAN_REFRESH)values (‘DEFAULT_LOGDS_LONG_CONN_NUM’, ‘5’, ‘默认LOG数据源长连接数’, 0);insert into esbcfgdb.sys_para (SYS_PARA_NAME, SYS_PARA_VALUE, DESCRIBES, IS_CAN_REFRESH)values (‘DEFAULT_DS_REMOVEABANDONEDTIMEOUT’, ‘60’, ‘丢弃连接超时时间(毫秒)’, 0);insert into esbcfgdb.sys_para (SYS_PARA_NAME, SYS_PARA_VALUE, DESCRIBES, IS_CAN_REFRESH)values (‘DEFAULT_DS_SETNUMTESTSPEREVICTIONRUN’, ‘2’, ‘逐出判定个数(个)’, 0);insert into esbcfgdb.sys_para (SYS_PARA_NAME, SYS_PARA_VALUE, DESCRIBES, IS_CAN_REFRESH)values (‘DEFAULT_DS_SETMINEVICTABLEIDLETIMEMILLIS’, ‘60000’, ‘连接最小逐出时间(毫秒)’, 0);insert into esbcfgdb.sys_para (SYS_PARA_NAME, SYS_PARA_VALUE, DESCRIBES, IS_CAN_REFRESH)values (‘DEFAULT_DS_TIMEBETWEENEVICTIONRUNSMILLIS’, ‘60000’, ‘连接逐出间隔(毫秒)’, 0);insert into esbcfgdb.sys_para (SYS_PARA_NAME, SYS_PARA_VALUE, DESCRIBES, IS_CAN_REFRESH)values (‘DS_VALIDATIONQUERY’, ‘select 1 from dual’, ‘数据库连接校验sql’, 0);insert into esbcfgdb.sys_para (SYS_PARA_NAME, SYS_PARA_VALUE, DESCRIBES, IS_CAN_REFRESH)values (‘DEFAULT_DS_REMOVEABANDONED’, ‘false’, ‘是否进行连接强制回收’, 0);commit;1.6.3主键：LOG_DB_NO唯一键: LOG_DB_NAMELOG_DB_NO LOG_DB_NAME LOG_DB_LINK_STR0 00 mysql://$LOG_DB_USER$:$LOG_DB_PASSWD$@132.42.33.188:3306/ESBLOGDB1 01 mysql://$LOG_DB_USER$:$LOG_DB_PASSWD$@132.42.33.187:3306/ESBLOGDB LOG_DB_NAME值与context.xml中EsbLogDS_00红色标注部分的一致 &lt;Resource name=”jdbc/EsbLogDS_00” auth=”Container”配CAF webapps tom__ 和 application__ 00 01 01]]></content>
  </entry>
  <entry>
    <title></title>
    <url>%2F2018%2F07%2F10%2FSpring-chapter1%2F</url>
    <content type="text"><![CDATA[title: 我的第一篇博客 安装Git Bash安装NodeJs安装hexo生成SSH并添加到github部署项目上传到github绑定个人域名修改及配置主题添加RSS添加评论写文章部分]]></content>
  </entry>
</search>
